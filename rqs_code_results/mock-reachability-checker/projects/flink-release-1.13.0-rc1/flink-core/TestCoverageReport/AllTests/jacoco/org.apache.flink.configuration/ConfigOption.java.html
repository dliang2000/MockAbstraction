<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConfigOption.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Flink : Core</a> &gt; <a href="index.source.html" class="el_package">org.apache.flink.configuration</a> &gt; <span class="el_source">ConfigOption.java</span></div><h1>ConfigOption.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.flink.configuration;

import org.apache.flink.annotation.PublicEvolving;
import org.apache.flink.configuration.description.Description;

import java.util.Arrays;
import java.util.Collections;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import static org.apache.flink.util.Preconditions.checkNotNull;

/**
 * A {@code ConfigOption} describes a configuration parameter. It encapsulates the configuration
 * key, deprecated older versions of the key, and an optional default value for the configuration
 * parameter.
 *
 * &lt;p&gt;{@code ConfigOptions} are built via the {@link ConfigOptions} class. Once created, a config
 * option is immutable.
 *
 * @param &lt;T&gt; The type of value associated with the configuration option.
 */
@PublicEvolving
public class ConfigOption&lt;T&gt; {

<span class="fc" id="L44">    private static final FallbackKey[] EMPTY = new FallbackKey[0];</span>

<span class="fc" id="L46">    static final Description EMPTY_DESCRIPTION = Description.builder().text(&quot;&quot;).build();</span>

    // ------------------------------------------------------------------------

    /** The current key for that config option. */
    private final String key;

    /** The list of deprecated keys, in the order to be checked. */
    private final FallbackKey[] fallbackKeys;

    /** The default value for this option. */
    private final T defaultValue;

    /** The description for this option. */
    private final Description description;

    /**
     * Type of the value that this ConfigOption describes.
     *
     * &lt;ul&gt;
     *   &lt;li&gt;typeClass == atomic class (e.g. {@code Integer.class}) -&gt; {@code ConfigOption&lt;Integer&gt;}
     *   &lt;li&gt;typeClass == {@code Map.class} -&gt; {@code ConfigOption&lt;Map&lt;String, String&gt;&gt;}
     *   &lt;li&gt;typeClass == atomic class and isList == true for {@code ConfigOption&lt;List&lt;Integer&gt;&gt;}
     * &lt;/ul&gt;
     */
    private final Class&lt;?&gt; clazz;

    private final boolean isList;

    // ------------------------------------------------------------------------

    Class&lt;?&gt; getClazz() {
<span class="fc" id="L78">        return clazz;</span>
    }

    boolean isList() {
<span class="fc" id="L82">        return isList;</span>
    }

    /**
     * Creates a new config option with fallback keys.
     *
     * @param key The current key for that config option
     * @param clazz describes type of the ConfigOption, see description of the clazz field
     * @param description Description for that option
     * @param defaultValue The default value for this option
     * @param isList tells if the ConfigOption describes a list option, see description of the clazz
     *     field
     * @param fallbackKeys The list of fallback keys, in the order to be checked
     */
    ConfigOption(
            String key,
            Class&lt;?&gt; clazz,
            Description description,
            T defaultValue,
            boolean isList,
<span class="fc" id="L102">            FallbackKey... fallbackKeys) {</span>
<span class="fc" id="L103">        this.key = checkNotNull(key);</span>
<span class="fc" id="L104">        this.description = description;</span>
<span class="fc" id="L105">        this.defaultValue = defaultValue;</span>
<span class="pc bpc" id="L106" title="1 of 4 branches missed.">        this.fallbackKeys = fallbackKeys == null || fallbackKeys.length == 0 ? EMPTY : fallbackKeys;</span>
<span class="fc" id="L107">        this.clazz = checkNotNull(clazz);</span>
<span class="fc" id="L108">        this.isList = isList;</span>
<span class="fc" id="L109">    }</span>

    // ------------------------------------------------------------------------

    /**
     * Creates a new config option, using this option's key and default value, and adding the given
     * fallback keys.
     *
     * &lt;p&gt;When obtaining a value from the configuration via {@link
     * Configuration#getValue(ConfigOption)}, the fallback keys will be checked in the order
     * provided to this method. The first key for which a value is found will be used - that value
     * will be returned.
     *
     * @param fallbackKeys The fallback keys, in the order in which they should be checked.
     * @return A new config options, with the given fallback keys.
     */
    public ConfigOption&lt;T&gt; withFallbackKeys(String... fallbackKeys) {
<span class="fc" id="L126">        final Stream&lt;FallbackKey&gt; newFallbackKeys =</span>
<span class="fc" id="L127">                Arrays.stream(fallbackKeys).map(FallbackKey::createFallbackKey);</span>
<span class="fc" id="L128">        final Stream&lt;FallbackKey&gt; currentAlternativeKeys = Arrays.stream(this.fallbackKeys);</span>

        // put fallback keys first so that they are prioritized
<span class="fc" id="L131">        final FallbackKey[] mergedAlternativeKeys =</span>
<span class="fc" id="L132">                Stream.concat(newFallbackKeys, currentAlternativeKeys).toArray(FallbackKey[]::new);</span>
<span class="fc" id="L133">        return new ConfigOption&lt;&gt;(</span>
                key, clazz, description, defaultValue, isList, mergedAlternativeKeys);
    }

    /**
     * Creates a new config option, using this option's key and default value, and adding the given
     * deprecated keys.
     *
     * &lt;p&gt;When obtaining a value from the configuration via {@link
     * Configuration#getValue(ConfigOption)}, the deprecated keys will be checked in the order
     * provided to this method. The first key for which a value is found will be used - that value
     * will be returned.
     *
     * @param deprecatedKeys The deprecated keys, in the order in which they should be checked.
     * @return A new config options, with the given deprecated keys.
     */
    public ConfigOption&lt;T&gt; withDeprecatedKeys(String... deprecatedKeys) {
<span class="fc" id="L150">        final Stream&lt;FallbackKey&gt; newDeprecatedKeys =</span>
<span class="fc" id="L151">                Arrays.stream(deprecatedKeys).map(FallbackKey::createDeprecatedKey);</span>
<span class="fc" id="L152">        final Stream&lt;FallbackKey&gt; currentAlternativeKeys = Arrays.stream(this.fallbackKeys);</span>

        // put deprecated keys last so that they are de-prioritized
<span class="fc" id="L155">        final FallbackKey[] mergedAlternativeKeys =</span>
<span class="fc" id="L156">                Stream.concat(currentAlternativeKeys, newDeprecatedKeys)</span>
<span class="fc" id="L157">                        .toArray(FallbackKey[]::new);</span>
<span class="fc" id="L158">        return new ConfigOption&lt;&gt;(</span>
                key, clazz, description, defaultValue, isList, mergedAlternativeKeys);
    }

    /**
     * Creates a new config option, using this option's key and default value, and adding the given
     * description. The given description is used when generation the configuration documention.
     *
     * @param description The description for this option.
     * @return A new config option, with given description.
     */
    public ConfigOption&lt;T&gt; withDescription(final String description) {
<span class="fc" id="L170">        return withDescription(Description.builder().text(description).build());</span>
    }

    /**
     * Creates a new config option, using this option's key and default value, and adding the given
     * description. The given description is used when generation the configuration documention.
     *
     * @param description The description for this option.
     * @return A new config option, with given description.
     */
    public ConfigOption&lt;T&gt; withDescription(final Description description) {
<span class="fc" id="L181">        return new ConfigOption&lt;&gt;(key, clazz, description, defaultValue, isList, fallbackKeys);</span>
    }

    // ------------------------------------------------------------------------

    /**
     * Gets the configuration key.
     *
     * @return The configuration key
     */
    public String key() {
<span class="fc" id="L192">        return key;</span>
    }

    /**
     * Checks if this option has a default value.
     *
     * @return True if it has a default value, false if not.
     */
    public boolean hasDefaultValue() {
<span class="nc bnc" id="L201" title="All 2 branches missed.">        return defaultValue != null;</span>
    }

    /**
     * Returns the default value, or null, if there is no default value.
     *
     * @return The default value, or null.
     */
    public T defaultValue() {
<span class="fc" id="L210">        return defaultValue;</span>
    }

    /**
     * Checks whether this option has deprecated keys.
     *
     * @return True if the option has deprecated keys, false if not.
     * @deprecated Replaced by {@link #hasFallbackKeys()}
     */
    @Deprecated
    public boolean hasDeprecatedKeys() {
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">        return fallbackKeys != EMPTY</span>
<span class="fc bfc" id="L222" title="All 2 branches covered.">                &amp;&amp; Arrays.stream(fallbackKeys).anyMatch(FallbackKey::isDeprecated);</span>
    }

    /**
     * Gets the deprecated keys, in the order to be checked.
     *
     * @return The option's deprecated keys.
     * @deprecated Replaced by {@link #fallbackKeys()}
     */
    @Deprecated
    public Iterable&lt;String&gt; deprecatedKeys() {
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">        return fallbackKeys == EMPTY</span>
<span class="pc" id="L234">                ? Collections.emptyList()</span>
<span class="fc" id="L235">                : Arrays.stream(fallbackKeys)</span>
<span class="fc" id="L236">                        .filter(FallbackKey::isDeprecated)</span>
<span class="fc" id="L237">                        .map(FallbackKey::getKey)</span>
<span class="fc" id="L238">                        .collect(Collectors.toList());</span>
    }

    /**
     * Checks whether this option has fallback keys.
     *
     * @return True if the option has fallback keys, false if not.
     */
    public boolean hasFallbackKeys() {
<span class="fc bfc" id="L247" title="All 2 branches covered.">        return fallbackKeys != EMPTY;</span>
    }

    /**
     * Gets the fallback keys, in the order to be checked.
     *
     * @return The option's fallback keys.
     */
    public Iterable&lt;FallbackKey&gt; fallbackKeys() {
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">        return (fallbackKeys == EMPTY) ? Collections.emptyList() : Arrays.asList(fallbackKeys);</span>
    }

    /**
     * Returns the description of this option.
     *
     * @return The option's description.
     */
    public Description description() {
<span class="nc" id="L265">        return description;</span>
    }

    // ------------------------------------------------------------------------

    @Override
    public boolean equals(Object o) {
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (this == o) {</span>
<span class="nc" id="L273">            return true;</span>
<span class="nc bnc" id="L274" title="All 4 branches missed.">        } else if (o != null &amp;&amp; o.getClass() == ConfigOption.class) {</span>
<span class="nc" id="L275">            ConfigOption&lt;?&gt; that = (ConfigOption&lt;?&gt;) o;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">            return this.key.equals(that.key)</span>
<span class="nc bnc" id="L277" title="All 8 branches missed.">                    &amp;&amp; Arrays.equals(this.fallbackKeys, that.fallbackKeys)</span>
                    &amp;&amp; (this.defaultValue == null
                            ? that.defaultValue == null
                            : (that.defaultValue != null
<span class="nc bnc" id="L281" title="All 2 branches missed.">                                    &amp;&amp; this.defaultValue.equals(that.defaultValue)));</span>
        } else {
<span class="nc" id="L283">            return false;</span>
        }
    }

    @Override
    public int hashCode() {
<span class="nc" id="L289">        return 31 * key.hashCode()</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                + 17 * Arrays.hashCode(fallbackKeys)</span>
<span class="nc" id="L291">                + (defaultValue != null ? defaultValue.hashCode() : 0);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L296">        return String.format(</span>
                &quot;Key: '%s' , default: %s (fallback keys: %s)&quot;,
<span class="fc" id="L298">                key, defaultValue, Arrays.toString(fallbackKeys));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>