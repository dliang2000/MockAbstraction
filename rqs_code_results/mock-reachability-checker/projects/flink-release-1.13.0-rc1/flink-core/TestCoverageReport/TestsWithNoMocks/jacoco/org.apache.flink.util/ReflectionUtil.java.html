<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReflectionUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Flink : Core</a> &gt; <a href="index.source.html" class="el_package">org.apache.flink.util</a> &gt; <span class="el_source">ReflectionUtil.java</span></div><h1>ReflectionUtil.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.flink.util;

import org.apache.flink.annotation.Internal;

import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.util.Arrays;
import java.util.Collections;
import java.util.Iterator;

/** Utility for reflection operations on classes and generic type parametrization. */
<span class="nc bnc" id="L30" title="All 2 branches missed.">@Internal</span>
@SuppressWarnings(&quot;unused&quot;)
public final class ReflectionUtil {

    public static &lt;T&gt; T newInstance(Class&lt;T&gt; clazz) {
        try {
<span class="nc" id="L36">            return clazz.newInstance();</span>
<span class="nc" id="L37">        } catch (Exception e) {</span>
<span class="nc" id="L38">            throw new RuntimeException(e);</span>
        }
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; Class&lt;T&gt; getTemplateType(Class&lt;?&gt; clazz, int num) {
<span class="nc" id="L44">        return (Class&lt;T&gt;) getSuperTemplateTypes(clazz)[num];</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; Class&lt;T&gt; getTemplateType(
            Class&lt;?&gt; clazz, Class&lt;?&gt; classWithParameter, int num) {
<span class="nc" id="L50">        return (Class&lt;T&gt;) getSuperTemplateTypes(clazz)[num];</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType1(Class&lt;?&gt; clazz) {
<span class="nc" id="L54">        return getTemplateType(clazz, 0);</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; Class&lt;T&gt; getTemplateType1(Type type) {
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (type instanceof ParameterizedType) {</span>
<span class="nc" id="L60">            return (Class&lt;T&gt;) getTemplateTypes((ParameterizedType) type)[0];</span>
        } else {
<span class="nc" id="L62">            throw new IllegalArgumentException();</span>
        }
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType2(Class&lt;?&gt; clazz) {
<span class="nc" id="L67">        return getTemplateType(clazz, 1);</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType3(Class&lt;?&gt; clazz) {
<span class="nc" id="L71">        return getTemplateType(clazz, 2);</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType4(Class&lt;?&gt; clazz) {
<span class="nc" id="L75">        return getTemplateType(clazz, 3);</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType5(Class&lt;?&gt; clazz) {
<span class="nc" id="L79">        return getTemplateType(clazz, 4);</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType6(Class&lt;?&gt; clazz) {
<span class="nc" id="L83">        return getTemplateType(clazz, 5);</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType7(Class&lt;?&gt; clazz) {
<span class="nc" id="L87">        return getTemplateType(clazz, 6);</span>
    }

    public static &lt;T&gt; Class&lt;T&gt; getTemplateType8(Class&lt;?&gt; clazz) {
<span class="nc" id="L91">        return getTemplateType(clazz, 7);</span>
    }

    public static Class&lt;?&gt;[] getSuperTemplateTypes(Class&lt;?&gt; clazz) {
<span class="nc" id="L95">        Type type = clazz.getGenericSuperclass();</span>
        while (true) {
<span class="nc bnc" id="L97" title="All 2 branches missed.">            if (type instanceof ParameterizedType) {</span>
<span class="nc" id="L98">                return getTemplateTypes((ParameterizedType) type);</span>
            }

<span class="nc bnc" id="L101" title="All 2 branches missed.">            if (clazz.getGenericSuperclass() == null) {</span>
<span class="nc" id="L102">                throw new IllegalArgumentException();</span>
            }

<span class="nc" id="L105">            type = clazz.getGenericSuperclass();</span>
<span class="nc" id="L106">            clazz = clazz.getSuperclass();</span>
        }
    }

    public static Class&lt;?&gt;[] getSuperTemplateTypes(Class&lt;?&gt; clazz, Class&lt;?&gt; searchedSuperClass) {
<span class="nc bnc" id="L111" title="All 4 branches missed.">        if (clazz == null || searchedSuperClass == null) {</span>
<span class="nc" id="L112">            throw new NullPointerException();</span>
        }

        Class&lt;?&gt; superClass;
        do {
<span class="nc" id="L117">            superClass = clazz.getSuperclass();</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">            if (superClass == searchedSuperClass) {</span>
<span class="nc" id="L119">                break;</span>
            }
<span class="nc bnc" id="L121" title="All 2 branches missed.">        } while ((clazz = superClass) != null);</span>

<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (clazz == null) {</span>
<span class="nc" id="L124">            throw new IllegalArgumentException(</span>
                    &quot;The searched for superclass is not a superclass of the given class.&quot;);
        }

<span class="nc" id="L128">        final Type type = clazz.getGenericSuperclass();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (type instanceof ParameterizedType) {</span>
<span class="nc" id="L130">            return getTemplateTypes((ParameterizedType) type);</span>
        } else {
<span class="nc" id="L132">            throw new IllegalArgumentException(</span>
                    &quot;The searched for superclass is not a generic class.&quot;);
        }
    }

    public static Class&lt;?&gt;[] getTemplateTypes(ParameterizedType paramterizedType) {
<span class="nc" id="L138">        Class&lt;?&gt;[] types = new Class&lt;?&gt;[paramterizedType.getActualTypeArguments().length];</span>
<span class="nc" id="L139">        int i = 0;</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        for (Type templateArgument : paramterizedType.getActualTypeArguments()) {</span>
<span class="nc bnc" id="L141" title="All 4 branches missed.">            assert templateArgument instanceof Class&lt;?&gt;;</span>
<span class="nc" id="L142">            types[i++] = (Class&lt;?&gt;) templateArgument;</span>
        }
<span class="nc" id="L144">        return types;</span>
    }

    public static Class&lt;?&gt;[] getTemplateTypes(Class&lt;?&gt; clazz) {
<span class="nc" id="L148">        Type type = clazz.getGenericSuperclass();</span>
<span class="nc bnc" id="L149" title="All 4 branches missed.">        assert (type instanceof ParameterizedType);</span>
<span class="nc" id="L150">        ParameterizedType paramterizedType = (ParameterizedType) type;</span>
<span class="nc" id="L151">        Class&lt;?&gt;[] types = new Class&lt;?&gt;[paramterizedType.getActualTypeArguments().length];</span>
<span class="nc" id="L152">        int i = 0;</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">        for (Type templateArgument : paramterizedType.getActualTypeArguments()) {</span>
<span class="nc bnc" id="L154" title="All 4 branches missed.">            assert (templateArgument instanceof Class&lt;?&gt;);</span>
<span class="nc" id="L155">            types[i++] = (Class&lt;?&gt;) templateArgument;</span>
        }
<span class="nc" id="L157">        return types;</span>
    }

    /**
     * Extract the full template type information from the given type's template parameter at the
     * given position.
     *
     * @param type type to extract the full template parameter information from
     * @param templatePosition describing at which position the template type parameter is
     * @return Full type information describing the template parameter's type
     */
    public static FullTypeInfo getFullTemplateType(Type type, int templatePosition) {
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (type instanceof ParameterizedType) {</span>
<span class="nc" id="L170">            return getFullTemplateType(</span>
<span class="nc" id="L171">                    ((ParameterizedType) type).getActualTypeArguments()[templatePosition]);</span>
        } else {
<span class="nc" id="L173">            throw new IllegalArgumentException();</span>
        }
    }

    /**
     * Extract the full type information from the given type.
     *
     * @param type to be analyzed
     * @return Full type information describing the given type
     */
    public static FullTypeInfo getFullTemplateType(Type type) {
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (type instanceof ParameterizedType) {</span>
<span class="nc" id="L185">            ParameterizedType parameterizedType = (ParameterizedType) type;</span>

<span class="nc" id="L187">            FullTypeInfo[] templateTypeInfos =</span>
<span class="nc" id="L188">                    new FullTypeInfo[parameterizedType.getActualTypeArguments().length];</span>

<span class="nc bnc" id="L190" title="All 2 branches missed.">            for (int i = 0; i &lt; parameterizedType.getActualTypeArguments().length; i++) {</span>
<span class="nc" id="L191">                templateTypeInfos[i] =</span>
<span class="nc" id="L192">                        getFullTemplateType(parameterizedType.getActualTypeArguments()[i]);</span>
            }

<span class="nc" id="L195">            return new FullTypeInfo((Class&lt;?&gt;) parameterizedType.getRawType(), templateTypeInfos);</span>
        } else {
<span class="nc" id="L197">            return new FullTypeInfo((Class&lt;?&gt;) type, null);</span>
        }
    }

    /**
     * Container for the full type information of a type. This means that it contains the {@link
     * Class} object and for each template parameter it contains a full type information describing
     * the type.
     */
    public static class FullTypeInfo {

        private final Class&lt;?&gt; clazz;
        private final FullTypeInfo[] templateTypeInfos;

<span class="nc" id="L211">        public FullTypeInfo(Class&lt;?&gt; clazz, FullTypeInfo[] templateTypeInfos) {</span>
<span class="nc" id="L212">            this.clazz = Preconditions.checkNotNull(clazz);</span>
<span class="nc" id="L213">            this.templateTypeInfos = templateTypeInfos;</span>
<span class="nc" id="L214">        }</span>

        public Class&lt;?&gt; getClazz() {
<span class="nc" id="L217">            return clazz;</span>
        }

        public FullTypeInfo[] getTemplateTypeInfos() {
<span class="nc" id="L221">            return templateTypeInfos;</span>
        }

        public Iterator&lt;Class&lt;?&gt;&gt; getClazzIterator() {
<span class="nc" id="L225">            UnionIterator&lt;Class&lt;?&gt;&gt; unionIterator = new UnionIterator&lt;&gt;();</span>

<span class="nc" id="L227">            unionIterator.add(Collections.&lt;Class&lt;?&gt;&gt;singleton(clazz).iterator());</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">            if (templateTypeInfos != null) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                for (int i = 0; i &lt; templateTypeInfos.length; i++) {</span>
<span class="nc" id="L231">                    unionIterator.add(templateTypeInfos[i].getClazzIterator());</span>
                }
            }

<span class="nc" id="L235">            return unionIterator;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L240">            StringBuilder builder = new StringBuilder();</span>

<span class="nc" id="L242">            builder.append(clazz.getSimpleName());</span>

<span class="nc bnc" id="L244" title="All 2 branches missed.">            if (templateTypeInfos != null) {</span>
<span class="nc" id="L245">                builder.append(&quot;&lt;&quot;);</span>

<span class="nc bnc" id="L247" title="All 2 branches missed.">                for (int i = 0; i &lt; templateTypeInfos.length - 1; i++) {</span>
<span class="nc" id="L248">                    builder.append(templateTypeInfos[i]).append(&quot;, &quot;);</span>
                }

<span class="nc" id="L251">                builder.append(templateTypeInfos[templateTypeInfos.length - 1]);</span>
<span class="nc" id="L252">                builder.append(&quot;&gt;&quot;);</span>
            }

<span class="nc" id="L255">            return builder.toString();</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (obj instanceof FullTypeInfo) {</span>
<span class="nc" id="L261">                FullTypeInfo other = (FullTypeInfo) obj;</span>

<span class="nc bnc" id="L263" title="All 2 branches missed.">                return clazz == other.getClazz()</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">                        &amp;&amp; Arrays.equals(templateTypeInfos, other.getTemplateTypeInfos());</span>
            } else {
<span class="nc" id="L266">                return false;</span>
            }
        }
    }

    /** Private constructor to prevent instantiation. */
<span class="nc" id="L272">    private ReflectionUtil() {</span>
<span class="nc" id="L273">        throw new RuntimeException();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>