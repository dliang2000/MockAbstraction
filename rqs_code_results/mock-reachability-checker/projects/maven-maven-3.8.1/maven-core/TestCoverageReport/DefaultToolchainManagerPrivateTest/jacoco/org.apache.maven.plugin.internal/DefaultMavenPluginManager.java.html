<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DefaultMavenPluginManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Maven Core</a> &gt; <a href="index.source.html" class="el_package">org.apache.maven.plugin.internal</a> &gt; <span class="el_source">DefaultMavenPluginManager.java</span></div><h1>DefaultMavenPluginManager.java</h1><pre class="source lang-java linenums">package org.apache.maven.plugin.internal;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import org.apache.maven.RepositoryUtils;
import org.apache.maven.artifact.Artifact;
import org.apache.maven.classrealm.ClassRealmManager;
import org.apache.maven.execution.MavenSession;
import org.apache.maven.execution.scope.internal.MojoExecutionScopeModule;
import org.apache.maven.model.Plugin;
import org.apache.maven.monitor.logging.DefaultLog;
import org.apache.maven.plugin.ContextEnabled;
import org.apache.maven.plugin.DebugConfigurationListener;
import org.apache.maven.plugin.ExtensionRealmCache;
import org.apache.maven.plugin.InvalidPluginDescriptorException;
import org.apache.maven.plugin.MavenPluginManager;
import org.apache.maven.plugin.MavenPluginValidator;
import org.apache.maven.plugin.Mojo;
import org.apache.maven.plugin.MojoExecution;
import org.apache.maven.plugin.MojoNotFoundException;
import org.apache.maven.plugin.PluginArtifactsCache;
import org.apache.maven.plugin.PluginConfigurationException;
import org.apache.maven.plugin.PluginContainerException;
import org.apache.maven.plugin.PluginDescriptorCache;
import org.apache.maven.plugin.PluginDescriptorParsingException;
import org.apache.maven.plugin.PluginIncompatibleException;
import org.apache.maven.plugin.PluginManagerException;
import org.apache.maven.plugin.PluginParameterException;
import org.apache.maven.plugin.PluginParameterExpressionEvaluator;
import org.apache.maven.plugin.PluginRealmCache;
import org.apache.maven.plugin.PluginResolutionException;
import org.apache.maven.plugin.descriptor.MojoDescriptor;
import org.apache.maven.plugin.descriptor.Parameter;
import org.apache.maven.plugin.descriptor.PluginDescriptor;
import org.apache.maven.plugin.descriptor.PluginDescriptorBuilder;
import org.apache.maven.plugin.version.DefaultPluginVersionRequest;
import org.apache.maven.plugin.version.PluginVersionRequest;
import org.apache.maven.plugin.version.PluginVersionResolutionException;
import org.apache.maven.plugin.version.PluginVersionResolver;
import org.apache.maven.project.ExtensionDescriptor;
import org.apache.maven.project.ExtensionDescriptorBuilder;
import org.apache.maven.project.MavenProject;
import org.apache.maven.rtinfo.RuntimeInformation;
import org.apache.maven.session.scope.internal.SessionScopeModule;
import org.codehaus.plexus.DefaultPlexusContainer;
import org.codehaus.plexus.PlexusContainer;
import org.codehaus.plexus.classworlds.realm.ClassRealm;
import org.codehaus.plexus.component.annotations.Component;
import org.codehaus.plexus.component.annotations.Requirement;
import org.codehaus.plexus.component.composition.CycleDetectedInComponentGraphException;
import org.codehaus.plexus.component.configurator.ComponentConfigurationException;
import org.codehaus.plexus.component.configurator.ComponentConfigurator;
import org.codehaus.plexus.component.configurator.ConfigurationListener;
import org.codehaus.plexus.component.configurator.expression.ExpressionEvaluationException;
import org.codehaus.plexus.component.configurator.expression.ExpressionEvaluator;
import org.codehaus.plexus.component.repository.ComponentDescriptor;
import org.codehaus.plexus.component.repository.exception.ComponentLifecycleException;
import org.codehaus.plexus.component.repository.exception.ComponentLookupException;
import org.codehaus.plexus.configuration.PlexusConfiguration;
import org.codehaus.plexus.configuration.PlexusConfigurationException;
import org.codehaus.plexus.configuration.xml.XmlPlexusConfiguration;
import org.codehaus.plexus.logging.Logger;
import org.codehaus.plexus.logging.LoggerManager;
import org.codehaus.plexus.util.ReaderFactory;
import org.codehaus.plexus.util.StringUtils;
import org.codehaus.plexus.util.xml.Xpp3Dom;
import org.eclipse.aether.RepositorySystemSession;
import org.eclipse.aether.graph.DependencyFilter;
import org.eclipse.aether.graph.DependencyNode;
import org.eclipse.aether.repository.RemoteRepository;
import org.eclipse.aether.util.filter.AndDependencyFilter;
import org.eclipse.aether.util.graph.visitor.PreorderNodeListGenerator;

import java.io.BufferedInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.PrintStream;
import java.io.Reader;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.jar.JarFile;
import java.util.zip.ZipEntry;

/**
 * Provides basic services to manage Maven plugins and their mojos. This component is kept general in its design such
 * that the plugins/mojos can be used in arbitrary contexts. In particular, the mojos can be used for ordinary build
 * plugins as well as special purpose plugins like reports.
 *
 * @author Benjamin Bentmann
 * @since 3.0
 */
@Component( role = MavenPluginManager.class )
<span class="nc" id="L119">public class DefaultMavenPluginManager</span>
    implements MavenPluginManager
{

    /**
     * &lt;p&gt;
     * PluginId =&amp;gt; ExtensionRealmCache.CacheRecord map MavenProject context value key. The map is used to ensure the
     * same class realm is used to load build extensions and load mojos for extensions=true plugins.
     * &lt;/p&gt;
     * &lt;strong&gt;Note:&lt;/strong&gt; This is part of internal implementation and may be changed or removed without notice
     * 
     * @since 3.3.0
     */
<span class="nc" id="L132">    public static final String KEY_EXTENSIONS_REALMS = DefaultMavenPluginManager.class.getName() + &quot;/extensionsRealms&quot;;</span>

    @Requirement
    private Logger logger;

    @Requirement
    private LoggerManager loggerManager;

    @Requirement
    private PlexusContainer container;

    @Requirement
    private ClassRealmManager classRealmManager;

    @Requirement
    private PluginDescriptorCache pluginDescriptorCache;

    @Requirement
    private PluginRealmCache pluginRealmCache;

    @Requirement
    private PluginDependenciesResolver pluginDependenciesResolver;

    @Requirement
    private RuntimeInformation runtimeInformation;

    @Requirement
    private ExtensionRealmCache extensionRealmCache;

    @Requirement
    private PluginVersionResolver pluginVersionResolver;

    @Requirement
    private PluginArtifactsCache pluginArtifactsCache;

<span class="nc" id="L167">    private ExtensionDescriptorBuilder extensionDescriptorBuilder = new ExtensionDescriptorBuilder();</span>

<span class="nc" id="L169">    private PluginDescriptorBuilder builder = new PluginDescriptorBuilder();</span>

    public synchronized PluginDescriptor getPluginDescriptor( Plugin plugin, List&lt;RemoteRepository&gt; repositories,
                                                              RepositorySystemSession session )
        throws PluginResolutionException, PluginDescriptorParsingException, InvalidPluginDescriptorException
    {
<span class="nc" id="L175">        PluginDescriptorCache.Key cacheKey = pluginDescriptorCache.createKey( plugin, repositories, session );</span>

<span class="nc" id="L177">        PluginDescriptor pluginDescriptor = pluginDescriptorCache.get( cacheKey );</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">        if ( pluginDescriptor == null )</span>
        {
<span class="nc" id="L181">            org.eclipse.aether.artifact.Artifact artifact =</span>
<span class="nc" id="L182">                pluginDependenciesResolver.resolve( plugin, repositories, session );</span>

<span class="nc" id="L184">            Artifact pluginArtifact = RepositoryUtils.toArtifact( artifact );</span>

<span class="nc" id="L186">            pluginDescriptor = extractPluginDescriptor( pluginArtifact, plugin );</span>

<span class="nc" id="L188">            pluginDescriptor.setRequiredMavenVersion( artifact.getProperty( &quot;requiredMavenVersion&quot;, null ) );</span>

<span class="nc" id="L190">            pluginDescriptorCache.put( cacheKey, pluginDescriptor );</span>
        }

<span class="nc" id="L193">        pluginDescriptor.setPlugin( plugin );</span>

<span class="nc" id="L195">        return pluginDescriptor;</span>
    }

    private PluginDescriptor extractPluginDescriptor( Artifact pluginArtifact, Plugin plugin )
        throws PluginDescriptorParsingException, InvalidPluginDescriptorException
    {
<span class="nc" id="L201">        PluginDescriptor pluginDescriptor = null;</span>

<span class="nc" id="L203">        File pluginFile = pluginArtifact.getFile();</span>

        try
        {
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if ( pluginFile.isFile() )</span>
            {
<span class="nc" id="L209">                try ( JarFile pluginJar = new JarFile( pluginFile, false ) )</span>
                {
<span class="nc" id="L211">                    ZipEntry pluginDescriptorEntry = pluginJar.getEntry( getPluginDescriptorLocation() );</span>

<span class="nc bnc" id="L213" title="All 2 branches missed.">                    if ( pluginDescriptorEntry != null )</span>
                    {
<span class="nc" id="L215">                        InputStream is = pluginJar.getInputStream( pluginDescriptorEntry );</span>

<span class="nc" id="L217">                        pluginDescriptor = parsePluginDescriptor( is, plugin, pluginFile.getAbsolutePath() );</span>
                    }
<span class="nc" id="L219">                }</span>
            }
            else
            {
<span class="nc" id="L223">                File pluginXml = new File( pluginFile, getPluginDescriptorLocation() );</span>

<span class="nc bnc" id="L225" title="All 2 branches missed.">                if ( pluginXml.isFile() )</span>
                {
<span class="nc" id="L227">                    try ( InputStream is = new BufferedInputStream( new FileInputStream( pluginXml ) ) )</span>
                    {
<span class="nc" id="L229">                        pluginDescriptor = parsePluginDescriptor( is, plugin, pluginXml.getAbsolutePath() );</span>
                    }
                }
            }

<span class="nc bnc" id="L234" title="All 2 branches missed.">            if ( pluginDescriptor == null )</span>
            {
<span class="nc" id="L236">                throw new IOException( &quot;No plugin descriptor found at &quot; + getPluginDescriptorLocation() );</span>
            }
        }
<span class="nc" id="L239">        catch ( IOException e )</span>
        {
<span class="nc" id="L241">            throw new PluginDescriptorParsingException( plugin, pluginFile.getAbsolutePath(), e );</span>
<span class="nc" id="L242">        }</span>

<span class="nc" id="L244">        MavenPluginValidator validator = new MavenPluginValidator( pluginArtifact );</span>

<span class="nc" id="L246">        validator.validate( pluginDescriptor );</span>

<span class="nc bnc" id="L248" title="All 2 branches missed.">        if ( validator.hasErrors() )</span>
        {
<span class="nc" id="L250">            throw new InvalidPluginDescriptorException(</span>
<span class="nc" id="L251">                &quot;Invalid plugin descriptor for &quot; + plugin.getId() + &quot; (&quot; + pluginFile + &quot;)&quot;, validator.getErrors() );</span>
        }

<span class="nc" id="L254">        pluginDescriptor.setPluginArtifact( pluginArtifact );</span>

<span class="nc" id="L256">        return pluginDescriptor;</span>
    }

    private String getPluginDescriptorLocation()
    {
<span class="nc" id="L261">        return &quot;META-INF/maven/plugin.xml&quot;;</span>
    }

    private PluginDescriptor parsePluginDescriptor( InputStream is, Plugin plugin, String descriptorLocation )
        throws PluginDescriptorParsingException
    {
        try
        {
<span class="nc" id="L269">            Reader reader = ReaderFactory.newXmlReader( is );</span>

<span class="nc" id="L271">            PluginDescriptor pluginDescriptor = builder.build( reader, descriptorLocation );</span>

<span class="nc" id="L273">            return pluginDescriptor;</span>
        }
<span class="nc" id="L275">        catch ( IOException | PlexusConfigurationException e )</span>
        {
<span class="nc" id="L277">            throw new PluginDescriptorParsingException( plugin, descriptorLocation, e );</span>
        }
    }

    public MojoDescriptor getMojoDescriptor( Plugin plugin, String goal, List&lt;RemoteRepository&gt; repositories,
                                             RepositorySystemSession session )
        throws MojoNotFoundException, PluginResolutionException, PluginDescriptorParsingException,
        InvalidPluginDescriptorException
    {
<span class="nc" id="L286">        PluginDescriptor pluginDescriptor = getPluginDescriptor( plugin, repositories, session );</span>

<span class="nc" id="L288">        MojoDescriptor mojoDescriptor = pluginDescriptor.getMojo( goal );</span>

<span class="nc bnc" id="L290" title="All 2 branches missed.">        if ( mojoDescriptor == null )</span>
        {
<span class="nc" id="L292">            throw new MojoNotFoundException( goal, pluginDescriptor );</span>
        }

<span class="nc" id="L295">        return mojoDescriptor;</span>
    }

    public void checkRequiredMavenVersion( PluginDescriptor pluginDescriptor )
        throws PluginIncompatibleException
    {
<span class="nc" id="L301">        String requiredMavenVersion = pluginDescriptor.getRequiredMavenVersion();</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">        if ( StringUtils.isNotBlank( requiredMavenVersion ) )</span>
        {
            try
            {
<span class="nc bnc" id="L306" title="All 2 branches missed.">                if ( !runtimeInformation.isMavenVersion( requiredMavenVersion ) )</span>
                {
<span class="nc" id="L308">                    throw new PluginIncompatibleException( pluginDescriptor.getPlugin(),</span>
<span class="nc" id="L309">                                                           &quot;The plugin &quot; + pluginDescriptor.getId()</span>
                                                               + &quot; requires Maven version &quot; + requiredMavenVersion );
                }
            }
<span class="nc" id="L313">            catch ( RuntimeException e )</span>
            {
<span class="nc" id="L315">                logger.warn( &quot;Could not verify plugin's Maven prerequisite: &quot; + e.getMessage() );</span>
<span class="nc" id="L316">            }</span>
        }
<span class="nc" id="L318">    }</span>

    public synchronized void setupPluginRealm( PluginDescriptor pluginDescriptor, MavenSession session,
                                               ClassLoader parent, List&lt;String&gt; imports, DependencyFilter filter )
        throws PluginResolutionException, PluginContainerException
    {
<span class="nc" id="L324">        Plugin plugin = pluginDescriptor.getPlugin();</span>
<span class="nc" id="L325">        MavenProject project = session.getCurrentProject();</span>

<span class="nc bnc" id="L327" title="All 2 branches missed.">        if ( plugin.isExtensions() )</span>
        {
            ExtensionRealmCache.CacheRecord extensionRecord;
            try
            {
<span class="nc" id="L332">                RepositorySystemSession repositorySession = session.getRepositorySession();</span>
<span class="nc" id="L333">                extensionRecord = setupExtensionsRealm( project, plugin, repositorySession );</span>
            }
<span class="nc" id="L335">            catch ( PluginManagerException e )</span>
            {
                // extensions realm is expected to be fully setup at this point
                // any exception means a problem in maven code, not a user error
<span class="nc" id="L339">                throw new IllegalStateException( e );</span>
<span class="nc" id="L340">            }</span>

<span class="nc" id="L342">            ClassRealm pluginRealm = extensionRecord.getRealm();</span>
<span class="nc" id="L343">            List&lt;Artifact&gt; pluginArtifacts = extensionRecord.getArtifacts();</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">            for ( ComponentDescriptor&lt;?&gt; componentDescriptor : pluginDescriptor.getComponents() )</span>
            {
<span class="nc" id="L347">                componentDescriptor.setRealm( pluginRealm );</span>
<span class="nc" id="L348">            }</span>

<span class="nc" id="L350">            pluginDescriptor.setClassRealm( pluginRealm );</span>
<span class="nc" id="L351">            pluginDescriptor.setArtifacts( pluginArtifacts );</span>
<span class="nc" id="L352">        }</span>
        else
        {
<span class="nc" id="L355">            Map&lt;String, ClassLoader&gt; foreignImports = calcImports( project, parent, imports );</span>

<span class="nc" id="L357">            PluginRealmCache.Key cacheKey = pluginRealmCache.createKey( plugin, parent, foreignImports, filter,</span>
<span class="nc" id="L358">                                                                        project.getRemotePluginRepositories(),</span>
<span class="nc" id="L359">                                                                        session.getRepositorySession() );</span>

<span class="nc" id="L361">            PluginRealmCache.CacheRecord cacheRecord = pluginRealmCache.get( cacheKey );</span>

<span class="nc bnc" id="L363" title="All 2 branches missed.">            if ( cacheRecord != null )</span>
            {
<span class="nc" id="L365">                pluginDescriptor.setClassRealm( cacheRecord.getRealm() );</span>
<span class="nc" id="L366">                pluginDescriptor.setArtifacts( new ArrayList&lt;&gt;( cacheRecord.getArtifacts() ) );</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                for ( ComponentDescriptor&lt;?&gt; componentDescriptor : pluginDescriptor.getComponents() )</span>
                {
<span class="nc" id="L369">                    componentDescriptor.setRealm( cacheRecord.getRealm() );</span>
<span class="nc" id="L370">                }</span>
            }
            else
            {
<span class="nc" id="L374">                createPluginRealm( pluginDescriptor, session, parent, foreignImports, filter );</span>

<span class="nc" id="L376">                cacheRecord =</span>
<span class="nc" id="L377">                    pluginRealmCache.put( cacheKey, pluginDescriptor.getClassRealm(), pluginDescriptor.getArtifacts() );</span>
            }

<span class="nc" id="L380">            pluginRealmCache.register( project, cacheKey, cacheRecord );</span>
        }
<span class="nc" id="L382">    }</span>

    private void createPluginRealm( PluginDescriptor pluginDescriptor, MavenSession session, ClassLoader parent,
                                    Map&lt;String, ClassLoader&gt; foreignImports, DependencyFilter filter )
        throws PluginResolutionException, PluginContainerException
    {
<span class="nc" id="L388">        Plugin plugin =</span>
<span class="nc" id="L389">            Objects.requireNonNull( pluginDescriptor.getPlugin(), &quot;pluginDescriptor.plugin cannot be null&quot; );</span>

<span class="nc" id="L391">        Artifact pluginArtifact = Objects.requireNonNull( pluginDescriptor.getPluginArtifact(),</span>
                                                          &quot;pluginDescriptor.pluginArtifact cannot be null&quot; );

<span class="nc" id="L394">        MavenProject project = session.getCurrentProject();</span>

        final ClassRealm pluginRealm;
        final List&lt;Artifact&gt; pluginArtifacts;

<span class="nc" id="L399">        RepositorySystemSession repositorySession = session.getRepositorySession();</span>
<span class="nc" id="L400">        DependencyFilter dependencyFilter = project.getExtensionDependencyFilter();</span>
<span class="nc" id="L401">        dependencyFilter = AndDependencyFilter.newInstance( dependencyFilter, filter );</span>

<span class="nc" id="L403">        DependencyNode root =</span>
<span class="nc" id="L404">            pluginDependenciesResolver.resolve( plugin, RepositoryUtils.toArtifact( pluginArtifact ), dependencyFilter,</span>
<span class="nc" id="L405">                                                project.getRemotePluginRepositories(), repositorySession );</span>

<span class="nc" id="L407">        PreorderNodeListGenerator nlg = new PreorderNodeListGenerator();</span>
<span class="nc" id="L408">        root.accept( nlg );</span>

<span class="nc" id="L410">        pluginArtifacts = toMavenArtifacts( root, nlg );</span>

<span class="nc" id="L412">        pluginRealm = classRealmManager.createPluginRealm( plugin, parent, null, foreignImports,</span>
<span class="nc" id="L413">                                                           toAetherArtifacts( pluginArtifacts ) );</span>

<span class="nc" id="L415">        discoverPluginComponents( pluginRealm, plugin, pluginDescriptor );</span>

<span class="nc" id="L417">        pluginDescriptor.setClassRealm( pluginRealm );</span>
<span class="nc" id="L418">        pluginDescriptor.setArtifacts( pluginArtifacts );</span>
<span class="nc" id="L419">    }</span>

    private void discoverPluginComponents( final ClassRealm pluginRealm, Plugin plugin,
                                           PluginDescriptor pluginDescriptor )
        throws PluginContainerException
    {
        try
        {
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if ( pluginDescriptor != null )</span>
            {
<span class="nc bnc" id="L429" title="All 2 branches missed.">                for ( ComponentDescriptor&lt;?&gt; componentDescriptor : pluginDescriptor.getComponents() )</span>
                {
<span class="nc" id="L431">                    componentDescriptor.setRealm( pluginRealm );</span>
<span class="nc" id="L432">                    container.addComponentDescriptor( componentDescriptor );</span>
<span class="nc" id="L433">                }</span>
            }

<span class="nc" id="L436">            ( (DefaultPlexusContainer) container ).discoverComponents( pluginRealm, new SessionScopeModule( container ),</span>
                                                                       new MojoExecutionScopeModule( container ) );
        }
<span class="nc" id="L439">        catch ( ComponentLookupException | CycleDetectedInComponentGraphException e )</span>
        {
<span class="nc" id="L441">            throw new PluginContainerException( plugin, pluginRealm,</span>
<span class="nc" id="L442">                                                &quot;Error in component graph of plugin &quot; + plugin.getId() + &quot;: &quot;</span>
<span class="nc" id="L443">                                                    + e.getMessage(), e );</span>
<span class="nc" id="L444">        }</span>
<span class="nc" id="L445">    }</span>

    private List&lt;org.eclipse.aether.artifact.Artifact&gt; toAetherArtifacts( final List&lt;Artifact&gt; pluginArtifacts )
    {
<span class="nc" id="L449">        return new ArrayList&lt;&gt;( RepositoryUtils.toArtifacts( pluginArtifacts ) );</span>
    }

    private List&lt;Artifact&gt; toMavenArtifacts( DependencyNode root, PreorderNodeListGenerator nlg )
    {
<span class="nc" id="L454">        List&lt;Artifact&gt; artifacts = new ArrayList&lt;&gt;( nlg.getNodes().size() );</span>
<span class="nc" id="L455">        RepositoryUtils.toArtifacts( artifacts, Collections.singleton( root ), Collections.&lt;String&gt;emptyList(), null );</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">        for ( Iterator&lt;Artifact&gt; it = artifacts.iterator(); it.hasNext(); )</span>
        {
<span class="nc" id="L458">            Artifact artifact = it.next();</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">            if ( artifact.getFile() == null )</span>
            {
<span class="nc" id="L461">                it.remove();</span>
            }
<span class="nc" id="L463">        }</span>
<span class="nc" id="L464">        return Collections.unmodifiableList( artifacts );</span>
    }

    private Map&lt;String, ClassLoader&gt; calcImports( MavenProject project, ClassLoader parent, List&lt;String&gt; imports )
    {
<span class="nc" id="L469">        Map&lt;String, ClassLoader&gt; foreignImports = new HashMap&lt;&gt;();</span>

<span class="nc" id="L471">        ClassLoader projectRealm = project.getClassRealm();</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if ( projectRealm != null )</span>
        {
<span class="nc" id="L474">            foreignImports.put( &quot;&quot;, projectRealm );</span>
        }
        else
        {
<span class="nc" id="L478">            foreignImports.put( &quot;&quot;, classRealmManager.getMavenApiRealm() );</span>
        }

<span class="nc bnc" id="L481" title="All 4 branches missed.">        if ( parent != null &amp;&amp; imports != null )</span>
        {
<span class="nc bnc" id="L483" title="All 2 branches missed.">            for ( String parentImport : imports )</span>
            {
<span class="nc" id="L485">                foreignImports.put( parentImport, parent );</span>
<span class="nc" id="L486">            }</span>
        }

<span class="nc" id="L489">        return foreignImports;</span>
    }

    public &lt;T&gt; T getConfiguredMojo( Class&lt;T&gt; mojoInterface, MavenSession session, MojoExecution mojoExecution )
        throws PluginConfigurationException, PluginContainerException
    {
<span class="nc" id="L495">        MojoDescriptor mojoDescriptor = mojoExecution.getMojoDescriptor();</span>

<span class="nc" id="L497">        PluginDescriptor pluginDescriptor = mojoDescriptor.getPluginDescriptor();</span>

<span class="nc" id="L499">        ClassRealm pluginRealm = pluginDescriptor.getClassRealm();</span>

<span class="nc bnc" id="L501" title="All 2 branches missed.">        if ( logger.isDebugEnabled() )</span>
        {
<span class="nc" id="L503">            logger.debug( &quot;Configuring mojo &quot; + mojoDescriptor.getId() + &quot; from plugin realm &quot; + pluginRealm );</span>
        }

        // We are forcing the use of the plugin realm for all lookups that might occur during
        // the lifecycle that is part of the lookup. Here we are specifically trying to keep
        // lookups that occur in contextualize calls in line with the right realm.
<span class="nc" id="L509">        ClassRealm oldLookupRealm = container.setLookupRealm( pluginRealm );</span>

<span class="nc" id="L511">        ClassLoader oldClassLoader = Thread.currentThread().getContextClassLoader();</span>
<span class="nc" id="L512">        Thread.currentThread().setContextClassLoader( pluginRealm );</span>

        try
        {
            T mojo;

            try
            {
<span class="nc" id="L520">                mojo = container.lookup( mojoInterface, mojoDescriptor.getRoleHint() );</span>
            }
<span class="nc" id="L522">            catch ( ComponentLookupException e )</span>
            {
<span class="nc" id="L524">                Throwable cause = e.getCause();</span>
<span class="nc bnc" id="L525" title="All 6 branches missed.">                while ( cause != null &amp;&amp; !( cause instanceof LinkageError )</span>
                    &amp;&amp; !( cause instanceof ClassNotFoundException ) )
                {
<span class="nc" id="L528">                    cause = cause.getCause();</span>
                }

<span class="nc bnc" id="L531" title="All 4 branches missed.">                if ( ( cause instanceof NoClassDefFoundError ) || ( cause instanceof ClassNotFoundException ) )</span>
                {
<span class="nc" id="L533">                    ByteArrayOutputStream os = new ByteArrayOutputStream( 1024 );</span>
<span class="nc" id="L534">                    PrintStream ps = new PrintStream( os );</span>
<span class="nc" id="L535">                    ps.println( &quot;Unable to load the mojo '&quot; + mojoDescriptor.getGoal() + &quot;' in the plugin '&quot;</span>
<span class="nc" id="L536">                                    + pluginDescriptor.getId() + &quot;'. A required class is missing: &quot;</span>
<span class="nc" id="L537">                                    + cause.getMessage() );</span>
<span class="nc" id="L538">                    pluginRealm.display( ps );</span>

<span class="nc" id="L540">                    throw new PluginContainerException( mojoDescriptor, pluginRealm, os.toString(), cause );</span>
                }
<span class="nc bnc" id="L542" title="All 2 branches missed.">                else if ( cause instanceof LinkageError )</span>
                {
<span class="nc" id="L544">                    ByteArrayOutputStream os = new ByteArrayOutputStream( 1024 );</span>
<span class="nc" id="L545">                    PrintStream ps = new PrintStream( os );</span>
<span class="nc" id="L546">                    ps.println( &quot;Unable to load the mojo '&quot; + mojoDescriptor.getGoal() + &quot;' in the plugin '&quot;</span>
<span class="nc" id="L547">                                    + pluginDescriptor.getId() + &quot;' due to an API incompatibility: &quot;</span>
<span class="nc" id="L548">                                    + e.getClass().getName() + &quot;: &quot; + cause.getMessage() );</span>
<span class="nc" id="L549">                    pluginRealm.display( ps );</span>

<span class="nc" id="L551">                    throw new PluginContainerException( mojoDescriptor, pluginRealm, os.toString(), cause );</span>
                }

<span class="nc" id="L554">                throw new PluginContainerException( mojoDescriptor, pluginRealm,</span>
<span class="nc" id="L555">                                                    &quot;Unable to load the mojo '&quot; + mojoDescriptor.getGoal()</span>
                                                        + &quot;' (or one of its required components) from the plugin '&quot;
<span class="nc" id="L557">                                                        + pluginDescriptor.getId() + &quot;'&quot;, e );</span>
<span class="nc" id="L558">            }</span>

<span class="nc bnc" id="L560" title="All 2 branches missed.">            if ( mojo instanceof ContextEnabled )</span>
            {
<span class="nc" id="L562">                MavenProject project = session.getCurrentProject();</span>

<span class="nc" id="L564">                Map&lt;String, Object&gt; pluginContext = session.getPluginContext( pluginDescriptor, project );</span>

<span class="nc bnc" id="L566" title="All 2 branches missed.">                if ( pluginContext != null )</span>
                {
<span class="nc" id="L568">                    pluginContext.put( &quot;project&quot;, project );</span>

<span class="nc" id="L570">                    pluginContext.put( &quot;pluginDescriptor&quot;, pluginDescriptor );</span>

<span class="nc" id="L572">                    ( (ContextEnabled) mojo ).setPluginContext( pluginContext );</span>
                }
            }

<span class="nc bnc" id="L576" title="All 2 branches missed.">            if ( mojo instanceof Mojo )</span>
            {
<span class="nc" id="L578">                Logger mojoLogger = loggerManager.getLoggerForComponent( mojoDescriptor.getImplementation() );</span>
<span class="nc" id="L579">                ( (Mojo) mojo ).setLog( new DefaultLog( mojoLogger ) );</span>
            }

<span class="nc" id="L582">            Xpp3Dom dom = mojoExecution.getConfiguration();</span>

            PlexusConfiguration pomConfiguration;

<span class="nc bnc" id="L586" title="All 2 branches missed.">            if ( dom == null )</span>
            {
<span class="nc" id="L588">                pomConfiguration = new XmlPlexusConfiguration( &quot;configuration&quot; );</span>
            }
            else
            {
<span class="nc" id="L592">                pomConfiguration = new XmlPlexusConfiguration( dom );</span>
            }

<span class="nc" id="L595">            ExpressionEvaluator expressionEvaluator = new PluginParameterExpressionEvaluator( session, mojoExecution );</span>

<span class="nc" id="L597">            populatePluginFields( mojo, mojoDescriptor, pluginRealm, pomConfiguration, expressionEvaluator );</span>

<span class="nc" id="L599">            return mojo;</span>
        }
        finally
        {
<span class="nc" id="L603">            Thread.currentThread().setContextClassLoader( oldClassLoader );</span>
<span class="nc" id="L604">            container.setLookupRealm( oldLookupRealm );</span>
        }
    }

    private void populatePluginFields( Object mojo, MojoDescriptor mojoDescriptor, ClassRealm pluginRealm,
                                       PlexusConfiguration configuration, ExpressionEvaluator expressionEvaluator )
        throws PluginConfigurationException
    {
<span class="nc" id="L612">        ComponentConfigurator configurator = null;</span>

<span class="nc" id="L614">        String configuratorId = mojoDescriptor.getComponentConfigurator();</span>

<span class="nc bnc" id="L616" title="All 2 branches missed.">        if ( StringUtils.isEmpty( configuratorId ) )</span>
        {
<span class="nc" id="L618">            configuratorId = &quot;basic&quot;;</span>
        }

        try
        {
            // TODO could the configuration be passed to lookup and the configurator known to plexus via the descriptor
            // so that this method could entirely be handled by a plexus lookup?
<span class="nc" id="L625">            configurator = container.lookup( ComponentConfigurator.class, configuratorId );</span>

<span class="nc" id="L627">            ConfigurationListener listener = new DebugConfigurationListener( logger );</span>

<span class="nc" id="L629">            ValidatingConfigurationListener validator =</span>
                new ValidatingConfigurationListener( mojo, mojoDescriptor, listener );

<span class="nc" id="L632">            logger.debug(</span>
<span class="nc" id="L633">                &quot;Configuring mojo '&quot; + mojoDescriptor.getId() + &quot;' with &quot; + configuratorId + &quot; configurator --&gt;&quot; );</span>

<span class="nc" id="L635">            configurator.configureComponent( mojo, configuration, expressionEvaluator, pluginRealm, validator );</span>

<span class="nc" id="L637">            logger.debug( &quot;-- end configuration --&quot; );</span>

<span class="nc" id="L639">            Collection&lt;Parameter&gt; missingParameters = validator.getMissingParameters();</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">            if ( !missingParameters.isEmpty() )</span>
            {
<span class="nc bnc" id="L642" title="All 2 branches missed.">                if ( &quot;basic&quot;.equals( configuratorId ) )</span>
                {
<span class="nc" id="L644">                    throw new PluginParameterException( mojoDescriptor, new ArrayList&lt;&gt;( missingParameters ) );</span>
                }
                else
                {
                    /*
                     * NOTE: Other configurators like the map-oriented one don't call into the listener, so do it the
                     * hard way.
                     */
<span class="nc" id="L652">                    validateParameters( mojoDescriptor, configuration, expressionEvaluator );</span>
                }
            }
        }
<span class="nc" id="L656">        catch ( ComponentConfigurationException e )</span>
        {
<span class="nc" id="L658">            String message = &quot;Unable to parse configuration of mojo &quot; + mojoDescriptor.getId();</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">            if ( e.getFailedConfiguration() != null )</span>
            {
<span class="nc" id="L661">                message += &quot; for parameter &quot; + e.getFailedConfiguration().getName();</span>
            }
<span class="nc" id="L663">            message += &quot;: &quot; + e.getMessage();</span>

<span class="nc" id="L665">            throw new PluginConfigurationException( mojoDescriptor.getPluginDescriptor(), message, e );</span>
        }
<span class="nc" id="L667">        catch ( ComponentLookupException e )</span>
        {
<span class="nc" id="L669">            throw new PluginConfigurationException( mojoDescriptor.getPluginDescriptor(),</span>
                                                    &quot;Unable to retrieve component configurator &quot; + configuratorId
<span class="nc" id="L671">                                                        + &quot; for configuration of mojo &quot; + mojoDescriptor.getId(), e );</span>
        }
<span class="nc" id="L673">        catch ( NoClassDefFoundError e )</span>
        {
<span class="nc" id="L675">            ByteArrayOutputStream os = new ByteArrayOutputStream( 1024 );</span>
<span class="nc" id="L676">            PrintStream ps = new PrintStream( os );</span>
<span class="nc" id="L677">            ps.println( &quot;A required class was missing during configuration of mojo &quot; + mojoDescriptor.getId() + &quot;: &quot;</span>
<span class="nc" id="L678">                            + e.getMessage() );</span>
<span class="nc" id="L679">            pluginRealm.display( ps );</span>

<span class="nc" id="L681">            throw new PluginConfigurationException( mojoDescriptor.getPluginDescriptor(), os.toString(), e );</span>
        }
<span class="nc" id="L683">        catch ( LinkageError e )</span>
        {
<span class="nc" id="L685">            ByteArrayOutputStream os = new ByteArrayOutputStream( 1024 );</span>
<span class="nc" id="L686">            PrintStream ps = new PrintStream( os );</span>
<span class="nc" id="L687">            ps.println(</span>
<span class="nc" id="L688">                &quot;An API incompatibility was encountered during configuration of mojo &quot; + mojoDescriptor.getId() + &quot;: &quot;</span>
<span class="nc" id="L689">                    + e.getClass().getName() + &quot;: &quot; + e.getMessage() );</span>
<span class="nc" id="L690">            pluginRealm.display( ps );</span>

<span class="nc" id="L692">            throw new PluginConfigurationException( mojoDescriptor.getPluginDescriptor(), os.toString(), e );</span>
        }
        finally
        {
<span class="nc bnc" id="L696" title="All 2 branches missed.">            if ( configurator != null )</span>
            {
                try
                {
<span class="nc" id="L700">                    container.release( configurator );</span>
                }
<span class="nc" id="L702">                catch ( ComponentLifecycleException e )</span>
                {
<span class="nc" id="L704">                    logger.debug( &quot;Failed to release mojo configurator - ignoring.&quot; );</span>
<span class="nc" id="L705">                }</span>
            }
        }
<span class="nc" id="L708">    }</span>

    private void validateParameters( MojoDescriptor mojoDescriptor, PlexusConfiguration configuration,
                                     ExpressionEvaluator expressionEvaluator )
        throws ComponentConfigurationException, PluginParameterException
    {
<span class="nc bnc" id="L714" title="All 2 branches missed.">        if ( mojoDescriptor.getParameters() == null )</span>
        {
<span class="nc" id="L716">            return;</span>
        }

<span class="nc" id="L719">        List&lt;Parameter&gt; invalidParameters = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L721" title="All 2 branches missed.">        for ( Parameter parameter : mojoDescriptor.getParameters() )</span>
        {
<span class="nc bnc" id="L723" title="All 2 branches missed.">            if ( !parameter.isRequired() )</span>
            {
<span class="nc" id="L725">                continue;</span>
            }

<span class="nc" id="L728">            Object value = null;</span>

<span class="nc" id="L730">            PlexusConfiguration config = configuration.getChild( parameter.getName(), false );</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">            if ( config != null )</span>
            {
<span class="nc" id="L733">                String expression = config.getValue( null );</span>

                try
                {
<span class="nc" id="L737">                    value = expressionEvaluator.evaluate( expression );</span>

<span class="nc bnc" id="L739" title="All 2 branches missed.">                    if ( value == null )</span>
                    {
<span class="nc" id="L741">                        value = config.getAttribute( &quot;default-value&quot;, null );</span>
                    }
                }
<span class="nc" id="L744">                catch ( ExpressionEvaluationException e )</span>
                {
<span class="nc" id="L746">                    String msg = &quot;Error evaluating the expression '&quot; + expression + &quot;' for configuration value '&quot;</span>
<span class="nc" id="L747">                        + configuration.getName() + &quot;'&quot;;</span>
<span class="nc" id="L748">                    throw new ComponentConfigurationException( configuration, msg, e );</span>
<span class="nc" id="L749">                }</span>
            }

<span class="nc bnc" id="L752" title="All 6 branches missed.">            if ( value == null &amp;&amp; ( config == null || config.getChildCount() &lt;= 0 ) )</span>
            {
<span class="nc" id="L754">                invalidParameters.add( parameter );</span>
            }
<span class="nc" id="L756">        }</span>

<span class="nc bnc" id="L758" title="All 2 branches missed.">        if ( !invalidParameters.isEmpty() )</span>
        {
<span class="nc" id="L760">            throw new PluginParameterException( mojoDescriptor, invalidParameters );</span>
        }
<span class="nc" id="L762">    }</span>

    public void releaseMojo( Object mojo, MojoExecution mojoExecution )
    {
<span class="nc bnc" id="L766" title="All 2 branches missed.">        if ( mojo != null )</span>
        {
            try
            {
<span class="nc" id="L770">                container.release( mojo );</span>
            }
<span class="nc" id="L772">            catch ( ComponentLifecycleException e )</span>
            {
<span class="nc" id="L774">                String goalExecId = mojoExecution.getGoal();</span>

<span class="nc bnc" id="L776" title="All 2 branches missed.">                if ( mojoExecution.getExecutionId() != null )</span>
                {
<span class="nc" id="L778">                    goalExecId += &quot; {execution: &quot; + mojoExecution.getExecutionId() + &quot;}&quot;;</span>
                }

<span class="nc" id="L781">                logger.debug( &quot;Error releasing mojo for &quot; + goalExecId, e );</span>
<span class="nc" id="L782">            }</span>
        }
<span class="nc" id="L784">    }</span>

    public ExtensionRealmCache.CacheRecord setupExtensionsRealm( MavenProject project, Plugin plugin,
                                                                 RepositorySystemSession session )
        throws PluginManagerException
    {
<span class="nc" id="L790">        @SuppressWarnings( &quot;unchecked&quot; ) Map&lt;String, ExtensionRealmCache.CacheRecord&gt; pluginRealms =</span>
<span class="nc" id="L791">            (Map&lt;String, ExtensionRealmCache.CacheRecord&gt;) project.getContextValue( KEY_EXTENSIONS_REALMS );</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">        if ( pluginRealms == null )</span>
        {
<span class="nc" id="L794">            pluginRealms = new HashMap&lt;&gt;();</span>
<span class="nc" id="L795">            project.setContextValue( KEY_EXTENSIONS_REALMS, pluginRealms );</span>
        }

<span class="nc" id="L798">        final String pluginKey = plugin.getId();</span>

<span class="nc" id="L800">        ExtensionRealmCache.CacheRecord extensionRecord = pluginRealms.get( pluginKey );</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">        if ( extensionRecord != null )</span>
        {
<span class="nc" id="L803">            return extensionRecord;</span>
        }

<span class="nc" id="L806">        final List&lt;RemoteRepository&gt; repositories = project.getRemotePluginRepositories();</span>

        // resolve plugin version as necessary
<span class="nc bnc" id="L809" title="All 2 branches missed.">        if ( plugin.getVersion() == null )</span>
        {
<span class="nc" id="L811">            PluginVersionRequest versionRequest = new DefaultPluginVersionRequest( plugin, session, repositories );</span>
            try
            {
<span class="nc" id="L814">                plugin.setVersion( pluginVersionResolver.resolve( versionRequest ).getVersion() );</span>
            }
<span class="nc" id="L816">            catch ( PluginVersionResolutionException e )</span>
            {
<span class="nc" id="L818">                throw new PluginManagerException( plugin, e.getMessage(), e );</span>
<span class="nc" id="L819">            }</span>
        }

        // resolve plugin artifacts
        List&lt;Artifact&gt; artifacts;
<span class="nc" id="L824">        PluginArtifactsCache.Key cacheKey = pluginArtifactsCache.createKey( plugin, null, repositories, session );</span>
        PluginArtifactsCache.CacheRecord recordArtifacts;
        try
        {
<span class="nc" id="L828">            recordArtifacts = pluginArtifactsCache.get( cacheKey );</span>
        }
<span class="nc" id="L830">        catch ( PluginResolutionException e )</span>
        {
<span class="nc" id="L832">            throw new PluginManagerException( plugin, e.getMessage(), e );</span>
<span class="nc" id="L833">        }</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">        if ( recordArtifacts != null )</span>
        {
<span class="nc" id="L836">            artifacts = recordArtifacts.getArtifacts();</span>
        }
        else
        {
            try
            {
<span class="nc" id="L842">                artifacts = resolveExtensionArtifacts( plugin, repositories, session );</span>
<span class="nc" id="L843">                recordArtifacts = pluginArtifactsCache.put( cacheKey, artifacts );</span>
            }
<span class="nc" id="L845">            catch ( PluginResolutionException e )</span>
            {
<span class="nc" id="L847">                pluginArtifactsCache.put( cacheKey, e );</span>
<span class="nc" id="L848">                pluginArtifactsCache.register( project, cacheKey, recordArtifacts );</span>
<span class="nc" id="L849">                throw new PluginManagerException( plugin, e.getMessage(), e );</span>
<span class="nc" id="L850">            }</span>
        }
<span class="nc" id="L852">        pluginArtifactsCache.register( project, cacheKey, recordArtifacts );</span>

        // create and cache extensions realms
<span class="nc" id="L855">        final ExtensionRealmCache.Key extensionKey = extensionRealmCache.createKey( artifacts );</span>
<span class="nc" id="L856">        extensionRecord = extensionRealmCache.get( extensionKey );</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">        if ( extensionRecord == null )</span>
        {
<span class="nc" id="L859">            ClassRealm extensionRealm =</span>
<span class="nc" id="L860">                classRealmManager.createExtensionRealm( plugin, toAetherArtifacts( artifacts ) );</span>

            // TODO figure out how to use the same PluginDescriptor when running mojos

<span class="nc" id="L864">            PluginDescriptor pluginDescriptor = null;</span>
<span class="nc bnc" id="L865" title="All 4 branches missed.">            if ( plugin.isExtensions() &amp;&amp; !artifacts.isEmpty() )</span>
            {
                // ignore plugin descriptor parsing errors at this point
                // these errors will reported during calculation of project build execution plan
                try
                {
<span class="nc" id="L871">                    pluginDescriptor = extractPluginDescriptor( artifacts.get( 0 ), plugin );</span>
                }
<span class="nc" id="L873">                catch ( PluginDescriptorParsingException | InvalidPluginDescriptorException e )</span>
                {
                    // ignore, see above
<span class="nc" id="L876">                }</span>
            }

<span class="nc" id="L879">            discoverPluginComponents( extensionRealm, plugin, pluginDescriptor );</span>

<span class="nc" id="L881">            ExtensionDescriptor extensionDescriptor = null;</span>
<span class="nc" id="L882">            Artifact extensionArtifact = artifacts.get( 0 );</span>
            try
            {
<span class="nc" id="L885">                extensionDescriptor = extensionDescriptorBuilder.build( extensionArtifact.getFile() );</span>
            }
<span class="nc" id="L887">            catch ( IOException e )</span>
            {
<span class="nc" id="L889">                String message = &quot;Invalid extension descriptor for &quot; + plugin.getId() + &quot;: &quot; + e.getMessage();</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">                if ( logger.isDebugEnabled() )</span>
                {
<span class="nc" id="L892">                    logger.error( message, e );</span>
                }
                else
                {
<span class="nc" id="L896">                    logger.error( message );</span>
                }
<span class="nc" id="L898">            }</span>
<span class="nc" id="L899">            extensionRecord = extensionRealmCache.put( extensionKey, extensionRealm, extensionDescriptor, artifacts );</span>
        }
<span class="nc" id="L901">        extensionRealmCache.register( project, extensionKey, extensionRecord );</span>
<span class="nc" id="L902">        pluginRealms.put( pluginKey, extensionRecord );</span>

<span class="nc" id="L904">        return extensionRecord;</span>
    }

    private List&lt;Artifact&gt; resolveExtensionArtifacts( Plugin extensionPlugin, List&lt;RemoteRepository&gt; repositories,
                                                      RepositorySystemSession session )
        throws PluginResolutionException
    {
<span class="nc" id="L911">        DependencyNode root = pluginDependenciesResolver.resolve( extensionPlugin, null, null, repositories, session );</span>
<span class="nc" id="L912">        PreorderNodeListGenerator nlg = new PreorderNodeListGenerator();</span>
<span class="nc" id="L913">        root.accept( nlg );</span>
<span class="nc" id="L914">        return toMavenArtifacts( root, nlg );</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>