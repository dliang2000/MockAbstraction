<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DynamicPropertiesRule.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jsonschema2pojo-core</a> &gt; <a href="index.source.html" class="el_package">org.jsonschema2pojo.rules</a> &gt; <span class="el_source">DynamicPropertiesRule.java</span></div><h1>DynamicPropertiesRule.java</h1><pre class="source lang-java linenums">/**
 * Copyright Â© 2010-2020 Nokia
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.jsonschema2pojo.rules;

import static com.sun.codemodel.JExpr.*;
import static com.sun.codemodel.JMod.*;

import java.util.Iterator;
import java.util.Map;

import org.jsonschema2pojo.Schema;
import org.jsonschema2pojo.util.LanguageFeatures;
import org.jsonschema2pojo.util.Models;

import com.fasterxml.jackson.databind.JsonNode;
import com.sun.codemodel.JBlock;
import com.sun.codemodel.JClass;
import com.sun.codemodel.JConditional;
import com.sun.codemodel.JDefinedClass;
import com.sun.codemodel.JExpression;
import com.sun.codemodel.JFieldRef;
import com.sun.codemodel.JInvocation;
import com.sun.codemodel.JMethod;
import com.sun.codemodel.JOp;
import com.sun.codemodel.JSwitch;
import com.sun.codemodel.JType;
import com.sun.codemodel.JTypeVar;
import com.sun.codemodel.JVar;

/**
 * Adds methods for dynamically getting, setting, and building properties.
 *
 * @author Christian Trimble
 *
 */
public class DynamicPropertiesRule implements Rule&lt;JDefinedClass, JDefinedClass&gt; {

    public static final String NOT_FOUND_VALUE_FIELD = &quot;NOT_FOUND_VALUE&quot;;
    public static final String SETTER_NAME = &quot;set&quot;;
    public static final String GETTER_NAME = &quot;get&quot;;
    public static final String BUILDER_NAME = &quot;with&quot;;
    public static final String DEFINED_SETTER_NAME = &quot;declaredProperty&quot;;
    public static final String DEFINED_GETTER_NAME = &quot;declaredPropertyOrNotFound&quot;;

    private RuleFactory ruleFactory;

<span class="fc" id="L61">    public DynamicPropertiesRule(RuleFactory ruleFactory) {</span>
<span class="fc" id="L62">        this.ruleFactory = ruleFactory;</span>
<span class="fc" id="L63">    }</span>

    /**
     * This rule adds dynamic getter, setter and builder methods based on the properties and additional properties
     * defined in a schema.
     * &lt;p&gt;
     * If accessors are being generated, then methods for getting and setting properties by name will be added.  These
     * methods first attempt to call the appropriate getter or setter for the property.  If the named property is not defined,
     * then the additional properties map is used.
     * &lt;p&gt;
     * If builders are being generated, then a method for building properties by name will be added.  This method first
     * attempts to call the builder for the property.  If no property with the supplied name is defined, then the additional
     * properties map is used.
     * &lt;p&gt;
     * The methods generated by this class throw an IllegalArgumentException, if the name specified for the property is unknown and
     * additional properties are not enabled.  A ClassCastException will be thrown, when the value being set is incompatible with the
     * type of the named property.
     *
     * @param nodeName
     *            the name of the node for which dynamic getters, setters, and builders are being added.
     * @param node
     *            the properties node, containing property names and their
     *            definition
     * @param parent
     *            the parent node
     * @param jclass
     *            the Java type which will have the given properties added
     * @param currentSchema
     *            the schema being implemented
     * @return the given jclass
     */
    @Override
    public JDefinedClass apply(String nodeName, JsonNode node, JsonNode parent, JDefinedClass jclass, Schema currentSchema) {
<span class="pc bpc" id="L96" title="1 of 2 branches missed.">        if (!ruleFactory.getGenerationConfig().isIncludeDynamicAccessors() ||</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">                (!ruleFactory.getGenerationConfig().isIncludeDynamicSetters() &amp;&amp;</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">                !ruleFactory.getGenerationConfig().isIncludeDynamicGetters() &amp;&amp;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                !ruleFactory.getGenerationConfig().isIncludeDynamicBuilders())) {</span>
<span class="fc" id="L100">            return jclass;</span>
        }

<span class="nc" id="L103">        boolean isIncludeGetters = ruleFactory.getGenerationConfig().isIncludeGetters();</span>
<span class="nc" id="L104">        boolean isIncludeSetters = ruleFactory.getGenerationConfig().isIncludeSetters();</span>
<span class="nc" id="L105">        boolean isGenerateBuilders = ruleFactory.getGenerationConfig().isGenerateBuilders();</span>

<span class="nc bnc" id="L107" title="All 6 branches missed.">        if (isIncludeGetters || isIncludeSetters || isGenerateBuilders) {</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">            if (LanguageFeatures.canUseJava7(ruleFactory.getGenerationConfig())) {</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">                if (isIncludeSetters) {</span>
<span class="nc" id="L110">                    addInternalSetMethodJava7(jclass, node);</span>
                }
<span class="nc bnc" id="L112" title="All 2 branches missed.">                if (isIncludeGetters) {</span>
<span class="nc" id="L113">                    addInternalGetMethodJava7(jclass, node);</span>
                }
            } else {
<span class="nc bnc" id="L116" title="All 2 branches missed.">                if (isIncludeSetters) {</span>
<span class="nc" id="L117">                    addInternalSetMethodJava6(jclass, node);</span>
                }
<span class="nc bnc" id="L119" title="All 2 branches missed.">                if (isIncludeGetters) {</span>
<span class="nc" id="L120">                    addInternalGetMethodJava6(jclass, node);</span>
                }
            }
        }

<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (isIncludeGetters) {</span>
<span class="nc" id="L126">            addGetMethods(jclass);</span>
        }

<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (isIncludeSetters) {</span>
<span class="nc" id="L130">            addSetMethods(jclass);</span>
        }

<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (isGenerateBuilders) {</span>
<span class="nc" id="L134">            addWithMethods(jclass);</span>
        }

<span class="nc" id="L137">        return jclass;</span>
    }

    void addGetMethods(JDefinedClass jclass) {
<span class="nc" id="L141">        JFieldRef notFoundVar = getOrAddNotFoundVar(jclass);</span>
<span class="nc" id="L142">        JMethod internalGetMethod = this.getInternalGetMethod(jclass);</span>
<span class="nc" id="L143">        addPublicGetMethod(jclass, internalGetMethod, notFoundVar);</span>
<span class="nc" id="L144">    }</span>

    JFieldRef getOrAddNotFoundVar(JDefinedClass jclass) {
<span class="fc" id="L147">        jclass.field(PROTECTED | STATIC | FINAL, Object.class, NOT_FOUND_VALUE_FIELD,</span>
<span class="fc" id="L148">                _new(jclass.owner()._ref(Object.class)));</span>
<span class="fc" id="L149">        return jclass.staticRef(NOT_FOUND_VALUE_FIELD);</span>
    }

    private JMethod addPublicGetMethod(JDefinedClass jclass, JMethod internalGetMethod, JFieldRef notFoundValue) {
<span class="nc" id="L153">        JMethod method = jclass.method(PUBLIC, jclass.owner()._ref(Object.class), GETTER_NAME);</span>
<span class="nc" id="L154">        JTypeVar returnType = method.generify(&quot;T&quot;);</span>
<span class="nc" id="L155">        method.type(returnType);</span>
<span class="nc" id="L156">        Models.suppressWarnings(method, &quot;unchecked&quot;);</span>
<span class="nc" id="L157">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L158">        JBlock body = method.body();</span>
<span class="nc" id="L159">        JVar valueVar = body.decl(jclass.owner()._ref(Object.class), &quot;value&quot;,</span>
<span class="nc" id="L160">                invoke(internalGetMethod).arg(nameParam).arg(notFoundValue));</span>
<span class="nc" id="L161">        JConditional found = method.body()._if(notFoundValue.ne(valueVar));</span>
<span class="nc" id="L162">        found._then()._return(cast(returnType, valueVar));</span>
<span class="nc" id="L163">        JBlock notFound = found._else();</span>

<span class="nc" id="L165">        JMethod getAdditionalProperties = jclass.getMethod(&quot;getAdditionalProperties&quot;, new JType[] {});</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (getAdditionalProperties != null) {</span>
<span class="nc" id="L167">            notFound._return(cast(returnType, invoke(getAdditionalProperties).invoke(&quot;get&quot;).arg(nameParam)));</span>
        } else {
<span class="nc" id="L169">            notFound._throw(illegalArgumentInvocation(jclass, nameParam));</span>
        }

<span class="nc" id="L172">        return method;</span>
    }

    private JMethod addInternalGetMethodJava7(JDefinedClass jclass, JsonNode propertiesNode) {
<span class="nc" id="L176">        JMethod method = jclass.method(PROTECTED, jclass.owner()._ref(Object.class), DEFINED_GETTER_NAME);</span>
<span class="nc" id="L177">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L178">        JVar notFoundParam = method.param(jclass.owner()._ref(Object.class), &quot;notFoundValue&quot;);</span>
<span class="nc" id="L179">        JBlock body = method.body();</span>
<span class="nc" id="L180">        JSwitch propertySwitch = body._switch(nameParam);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (propertiesNode != null) {</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">            for (Iterator&lt;Map.Entry&lt;String, JsonNode&gt;&gt; properties = propertiesNode.fields(); properties.hasNext();) {</span>
<span class="nc" id="L183">                Map.Entry&lt;String, JsonNode&gt; property = properties.next();</span>
<span class="nc" id="L184">                String propertyName = property.getKey();</span>
<span class="nc" id="L185">                JsonNode node = property.getValue();</span>
<span class="nc" id="L186">                String fieldName = ruleFactory.getNameHelper().getPropertyName(propertyName, node);</span>
<span class="nc" id="L187">                JType propertyType = jclass.fields().get(fieldName).type();</span>

<span class="nc" id="L189">                addGetPropertyCase(jclass, propertySwitch, propertyName, propertyType, node);</span>
<span class="nc" id="L190">            }</span>
        }
<span class="nc" id="L192">        JClass extendsType = jclass._extends();</span>
<span class="nc bnc" id="L193" title="All 4 branches missed.">        if (extendsType != null &amp;&amp; extendsType instanceof JDefinedClass) {</span>
<span class="nc" id="L194">            JDefinedClass parentClass = (JDefinedClass) extendsType;</span>
<span class="nc" id="L195">            JMethod parentMethod = parentClass.getMethod(DEFINED_GETTER_NAME,</span>
<span class="nc" id="L196">                    new JType[] { parentClass.owner()._ref(String.class), parentClass.owner()._ref(Object.class) });</span>
<span class="nc" id="L197">            propertySwitch._default().body()</span>
<span class="nc" id="L198">            ._return(_super().invoke(parentMethod).arg(nameParam).arg(notFoundParam));</span>
<span class="nc" id="L199">        } else {</span>
<span class="nc" id="L200">            propertySwitch._default().body()</span>
<span class="nc" id="L201">            ._return(notFoundParam);</span>
        }

<span class="nc" id="L204">        return method;</span>
    }

    private JMethod addInternalGetMethodJava6(JDefinedClass jclass, JsonNode propertiesNode) {
<span class="nc" id="L208">        JMethod method = jclass.method(PROTECTED, jclass.owner()._ref(Object.class), DEFINED_GETTER_NAME);</span>
<span class="nc" id="L209">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L210">        JVar notFoundParam = method.param(jclass.owner()._ref(Object.class), &quot;notFoundValue&quot;);</span>
<span class="nc" id="L211">        JBlock body = method.body();</span>
<span class="nc" id="L212">        JConditional propertyConditional = null;</span>

<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (propertiesNode != null) {</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">            for (Iterator&lt;Map.Entry&lt;String, JsonNode&gt;&gt; properties = propertiesNode.fields(); properties.hasNext();) {</span>
<span class="nc" id="L216">                Map.Entry&lt;String, JsonNode&gt; property = properties.next();</span>
<span class="nc" id="L217">                String propertyName = property.getKey();</span>
<span class="nc" id="L218">                JsonNode node = property.getValue();</span>
<span class="nc" id="L219">                String fieldName = ruleFactory.getNameHelper().getPropertyName(propertyName, node);</span>
<span class="nc" id="L220">                JType propertyType = jclass.fields().get(fieldName).type();</span>

<span class="nc" id="L222">                JExpression condition = lit(propertyName).invoke(&quot;equals&quot;).arg(nameParam);</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                if (propertyConditional == null) {</span>
<span class="nc" id="L224">                    propertyConditional = body._if(condition);</span>
                } else {
<span class="nc" id="L226">                    propertyConditional = propertyConditional._elseif(condition);</span>
                }
<span class="nc" id="L228">                JMethod propertyGetter = jclass.getMethod(getGetterName(propertyName, propertyType, node), new JType[] {});</span>
<span class="nc" id="L229">                propertyConditional._then()._return(invoke(propertyGetter));</span>
<span class="nc" id="L230">            }</span>
        }

<span class="nc" id="L233">        JClass extendsType = jclass._extends();</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">        JBlock lastBlock = propertyConditional == null ? body : propertyConditional._else();</span>
<span class="nc bnc" id="L235" title="All 4 branches missed.">        if (extendsType != null &amp;&amp; extendsType instanceof JDefinedClass) {</span>
<span class="nc" id="L236">            JDefinedClass parentClass = (JDefinedClass) extendsType;</span>
<span class="nc" id="L237">            JMethod parentMethod = parentClass.getMethod(DEFINED_GETTER_NAME,</span>
<span class="nc" id="L238">                    new JType[] { parentClass.owner()._ref(String.class), parentClass.owner()._ref(Object.class) });</span>
<span class="nc" id="L239">            lastBlock._return(_super().invoke(parentMethod).arg(nameParam).arg(notFoundParam));</span>
<span class="nc" id="L240">        } else {</span>
<span class="nc" id="L241">            lastBlock._return(notFoundParam);</span>
        }

<span class="nc" id="L244">        return method;</span>
    }

    private void addGetPropertyCase(JDefinedClass jclass, JSwitch propertySwitch, String propertyName, JType propertyType, JsonNode node) {
<span class="nc" id="L248">        JMethod propertyGetter = jclass.getMethod(getGetterName(propertyName, propertyType, node), new JType[] {});</span>
<span class="nc" id="L249">        propertySwitch._case(lit(propertyName)).body()</span>
<span class="nc" id="L250">        ._return(invoke(propertyGetter));</span>
<span class="nc" id="L251">    }</span>

    private void addSetMethods(JDefinedClass jclass) {
<span class="nc" id="L254">        JMethod internalSetMethod = getInternalSetMethod(jclass);</span>
<span class="nc" id="L255">        addPublicSetMethod(jclass, internalSetMethod);</span>
<span class="nc" id="L256">    }</span>

    private JMethod addPublicSetMethod(JDefinedClass jclass, JMethod internalSetMethod) {
<span class="nc" id="L259">        JMethod method = jclass.method(PUBLIC, jclass.owner().VOID, SETTER_NAME);</span>
<span class="nc" id="L260">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L261">        JVar valueParam = method.param(Object.class, &quot;value&quot;);</span>
<span class="nc" id="L262">        JBlock body = method.body();</span>
<span class="nc" id="L263">        JBlock notFound = body._if(JOp.not(invoke(internalSetMethod).arg(nameParam).arg(valueParam)))._then();</span>

        // if we have additional properties, then put value.
<span class="nc" id="L266">        JMethod getAdditionalProperties = jclass.getMethod(&quot;getAdditionalProperties&quot;, new JType[] {});</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (getAdditionalProperties != null) {</span>
<span class="nc" id="L268">            JType additionalPropertiesType = ((JClass) (getAdditionalProperties.type())).getTypeParameters().get(1);</span>
<span class="nc" id="L269">            notFound.add(invoke(getAdditionalProperties).invoke(&quot;put&quot;).arg(nameParam)</span>
<span class="nc" id="L270">                    .arg(cast(additionalPropertiesType, valueParam)));</span>
<span class="nc" id="L271">        }</span>
        // else throw exception.
        else {
<span class="nc" id="L274">            notFound._throw(illegalArgumentInvocation(jclass, nameParam));</span>
        }

<span class="nc" id="L277">        return method;</span>
    }

    private void addWithMethods(JDefinedClass jclass) {
<span class="nc" id="L281">        JMethod internalSetMethod = getInternalSetMethod(jclass);</span>
<span class="nc" id="L282">        addPublicWithMethod(jclass, internalSetMethod);</span>
<span class="nc" id="L283">    }</span>

    private JMethod addPublicWithMethod(JDefinedClass jclass, JMethod internalSetMethod) {
<span class="nc" id="L286">        JMethod method = jclass.method(PUBLIC, jclass, BUILDER_NAME);</span>
<span class="nc" id="L287">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L288">        JVar valueParam = method.param(Object.class, &quot;value&quot;);</span>
<span class="nc" id="L289">        JBlock body = method.body();</span>
<span class="nc" id="L290">        JBlock notFound = body._if(JOp.not(invoke(internalSetMethod).arg(nameParam).arg(valueParam)))._then();</span>

        // if we have additional properties, then put value.
<span class="nc" id="L293">        JMethod getAdditionalProperties = jclass.getMethod(&quot;getAdditionalProperties&quot;, new JType[] {});</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (getAdditionalProperties != null) {</span>
<span class="nc" id="L295">            JType additionalPropertiesType = ((JClass) (getAdditionalProperties.type())).getTypeParameters().get(1);</span>
<span class="nc" id="L296">            notFound.add(invoke(getAdditionalProperties).invoke(&quot;put&quot;).arg(nameParam)</span>
<span class="nc" id="L297">                    .arg(cast(additionalPropertiesType, valueParam)));</span>
<span class="nc" id="L298">        }</span>
        // else throw exception.
        else {
<span class="nc" id="L301">            notFound._throw(illegalArgumentInvocation(jclass, nameParam));</span>
        }
<span class="nc" id="L303">        body._return(_this());</span>

<span class="nc" id="L305">        return method;</span>
    }

    private JMethod addInternalSetMethodJava7(JDefinedClass jclass, JsonNode propertiesNode) {
<span class="nc" id="L309">        JMethod method = jclass.method(PROTECTED, jclass.owner().BOOLEAN, DEFINED_SETTER_NAME);</span>
<span class="nc" id="L310">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L311">        JVar valueParam = method.param(Object.class, &quot;value&quot;);</span>
<span class="nc" id="L312">        JBlock body = method.body();</span>
<span class="nc" id="L313">        JSwitch propertySwitch = body._switch(nameParam);</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (propertiesNode != null) {</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">            for (Iterator&lt;Map.Entry&lt;String, JsonNode&gt;&gt; properties = propertiesNode.fields(); properties.hasNext();) {</span>
<span class="nc" id="L316">                Map.Entry&lt;String, JsonNode&gt; property = properties.next();</span>
<span class="nc" id="L317">                String propertyName = property.getKey();</span>
<span class="nc" id="L318">                JsonNode node = property.getValue();</span>
<span class="nc" id="L319">                String fieldName = ruleFactory.getNameHelper().getPropertyName(propertyName, node);</span>
<span class="nc" id="L320">                JType propertyType = jclass.fields().get(fieldName).type();</span>

<span class="nc" id="L322">                addSetPropertyCase(jclass, propertySwitch, propertyName, propertyType, valueParam, node);</span>
<span class="nc" id="L323">            }</span>
        }
<span class="nc" id="L325">        JBlock defaultBlock = propertySwitch._default().body();</span>
<span class="nc" id="L326">        JClass extendsType = jclass._extends();</span>
<span class="nc bnc" id="L327" title="All 4 branches missed.">        if (extendsType != null &amp;&amp; extendsType instanceof JDefinedClass) {</span>
<span class="nc" id="L328">            JDefinedClass parentClass = (JDefinedClass) extendsType;</span>
<span class="nc" id="L329">            JMethod parentMethod = parentClass.getMethod(DEFINED_SETTER_NAME,</span>
<span class="nc" id="L330">                    new JType[] { parentClass.owner()._ref(String.class), parentClass.owner()._ref(Object.class) });</span>
<span class="nc" id="L331">            defaultBlock._return(_super().invoke(parentMethod).arg(nameParam).arg(valueParam));</span>
<span class="nc" id="L332">        } else {</span>
<span class="nc" id="L333">            defaultBlock._return(FALSE);</span>
        }
<span class="nc" id="L335">        return method;</span>
    }

    private JMethod addInternalSetMethodJava6(JDefinedClass jclass, JsonNode propertiesNode) {
<span class="nc" id="L339">        JMethod method = jclass.method(PROTECTED, jclass.owner().BOOLEAN, DEFINED_SETTER_NAME);</span>
<span class="nc" id="L340">        JVar nameParam = method.param(String.class, &quot;name&quot;);</span>
<span class="nc" id="L341">        JVar valueParam = method.param(Object.class, &quot;value&quot;);</span>
<span class="nc" id="L342">        JBlock body = method.body();</span>
<span class="nc" id="L343">        JConditional propertyConditional = null;</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">        if (propertiesNode != null) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">            for (Iterator&lt;Map.Entry&lt;String, JsonNode&gt;&gt; properties = propertiesNode.fields(); properties.hasNext();) {</span>
<span class="nc" id="L346">                Map.Entry&lt;String, JsonNode&gt; property = properties.next();</span>
<span class="nc" id="L347">                String propertyName = property.getKey();</span>
<span class="nc" id="L348">                JsonNode node = property.getValue();</span>
<span class="nc" id="L349">                String fieldName = ruleFactory.getNameHelper().getPropertyName(propertyName, node);</span>
<span class="nc" id="L350">                JType propertyType = jclass.fields().get(fieldName).type();</span>
<span class="nc" id="L351">                JExpression condition = lit(propertyName).invoke(&quot;equals&quot;).arg(nameParam);</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                propertyConditional = propertyConditional == null ? propertyConditional = body._if(condition)</span>
<span class="nc" id="L353">                        : propertyConditional._elseif(condition);</span>

<span class="nc" id="L355">                JBlock callSite = propertyConditional._then();</span>
<span class="nc" id="L356">                addSetProperty(jclass, callSite, propertyName, propertyType, valueParam, node);</span>
<span class="nc" id="L357">                callSite._return(TRUE);</span>
<span class="nc" id="L358">            }</span>
        }
<span class="nc" id="L360">        JClass extendsType = jclass._extends();</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">        JBlock lastBlock = propertyConditional == null ? body : propertyConditional._else();</span>

<span class="nc bnc" id="L363" title="All 4 branches missed.">        if (extendsType != null &amp;&amp; extendsType instanceof JDefinedClass) {</span>
<span class="nc" id="L364">            JDefinedClass parentClass = (JDefinedClass) extendsType;</span>
<span class="nc" id="L365">            JMethod parentMethod = parentClass.getMethod(DEFINED_SETTER_NAME,</span>
<span class="nc" id="L366">                    new JType[] { parentClass.owner()._ref(String.class), parentClass.owner()._ref(Object.class) });</span>
<span class="nc" id="L367">            lastBlock._return(_super().invoke(parentMethod).arg(nameParam).arg(valueParam));</span>
<span class="nc" id="L368">        } else {</span>
<span class="nc" id="L369">            lastBlock._return(FALSE);</span>
        }
<span class="nc" id="L371">        return method;</span>
    }

    private JMethod getInternalSetMethod(JDefinedClass jclass) {
<span class="nc" id="L375">        return jclass.getMethod(DEFINED_SETTER_NAME,</span>
<span class="nc" id="L376">                new JType[] { jclass.owner().ref(String.class), jclass.owner().ref(Object.class) });</span>
    }

    private JMethod getInternalGetMethod(JDefinedClass jclass) {
<span class="nc" id="L380">        return jclass.getMethod(DEFINED_GETTER_NAME,</span>
<span class="nc" id="L381">                new JType[] { jclass.owner().ref(String.class), jclass.owner().ref(Object.class) });</span>
    }

    private void addSetPropertyCase(JDefinedClass jclass, JSwitch setterSwitch, String propertyName, JType propertyType, JVar valueVar, JsonNode node) {
<span class="nc" id="L385">        JBlock setterBody = setterSwitch._case(lit(propertyName)).body();</span>
<span class="nc" id="L386">        addSetProperty(jclass, setterBody, propertyName, propertyType, valueVar, node);</span>
<span class="nc" id="L387">        setterBody._return(TRUE);</span>
<span class="nc" id="L388">    }</span>

    private void addSetProperty(JDefinedClass jclass, JBlock callSite, String propertyName, JType propertyType, JVar valueVar, JsonNode node) {
<span class="nc" id="L391">        JMethod propertySetter = jclass.getMethod(getSetterName(propertyName, node), new JType[] { propertyType });</span>
<span class="nc" id="L392">        JConditional isInstance = callSite._if(valueVar._instanceof(propertyType.boxify().erasure()));</span>
<span class="nc" id="L393">        isInstance._then()</span>
<span class="nc" id="L394">        .invoke(propertySetter).arg(cast(propertyType.boxify(), valueVar));</span>
<span class="nc" id="L395">        isInstance._else()</span>
<span class="nc" id="L396">        ._throw(illegalArgumentInvocation(jclass, propertyName, propertyType, valueVar));</span>
<span class="nc" id="L397">    }</span>

    private JInvocation illegalArgumentInvocation(JDefinedClass jclass, JVar propertyName) {
<span class="nc" id="L400">        return _new(jclass.owner()._ref(IllegalArgumentException.class))</span>
<span class="nc" id="L401">                .arg(lit(&quot;property \&quot;&quot;).plus(propertyName).plus(lit(&quot;\&quot; is not defined&quot;)));</span>
    }

    private JInvocation illegalArgumentInvocation(JDefinedClass jclass, String propertyName, JType propertyType, JVar valueVar) {
<span class="nc" id="L405">        return _new(jclass.owner()._ref(IllegalArgumentException.class))</span>
<span class="nc" id="L406">                .arg(lit(&quot;property \&quot;&quot; + propertyName + &quot;\&quot; is of type \&quot;&quot; + propertyType.fullName() + &quot;\&quot;, but got &quot;)</span>
<span class="nc" id="L407">                        .plus(valueVar.invoke(&quot;getClass&quot;).invoke(&quot;toString&quot;)));</span>
    }

    private String getSetterName(String propertyName, JsonNode node) {
<span class="nc" id="L411">        return ruleFactory.getNameHelper().getSetterName(propertyName, node);</span>
    }

    private String getGetterName(String propertyName, JType type, JsonNode node) {
<span class="nc" id="L415">        return ruleFactory.getNameHelper().getGetterName(propertyName, type, node);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>